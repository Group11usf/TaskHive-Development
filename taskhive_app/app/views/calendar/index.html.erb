<title>Calendar</title>

<head>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
</head>
<body>
  <header>
    <h1>TaskHive</h1> 
  </header>
    <nav>
      <ul>
        <% if authenticated? %>
          <li><%= link_to 'Home', root_path %></li>
          <li><%= link_to 'Dashboard', dashboard_path %></li>
          <li><%= link_to 'Calendar', calendar_path %></li>
          <li><%= link_to 'Log Out', login_path,  method: :delete if authenticated? %></li>
        <% end %>
      </ul>
    </nav>

<div class="container">
<body>
  <% require 'date' %>
  <% displayed_date = @displayed_date || Date.today %>
  <% currentDate = Date.today %>
  <% current_year = displayed_date.year %>
  <% current_month = displayed_date.month %>
  <% first_day = Date.new(current_year, current_month, 1) %>
  <% last_day = Date.new(current_year, current_month, -1) %>
  <% start_day = first_day - first_day.wday %>
  <% end_day = last_day + (6 - last_day.wday) %>

  <div class="navigation">
    <h1 class="header"><%= displayed_date.strftime("%B %Y") %></h1>
    
  <%= link_to "Previous Month", calendar_path(year: displayed_date.prev_month.year, month: displayed_date.prev_month.month), class: "btn prev"%>

    <%= link_to "Next Month", calendar_path(year: displayed_date.next_month.year, month: displayed_date.next_month.month), class: "btn next" %>

    <%= button_to "Clear All Tasks", clear_tasks_path, method: :delete, 
    data: { confirm: "Are you sure you want to delete ALL tasks?" }, 
    class: "btn clear-tasks" %>

  </div>

  <div class="calendar_container">
    <table>
      <thead>
        <tr>
          <th>Sun</th>
          <th>Mon</th>
          <th>Tue</th>
          <th>Wed</th>
          <th>Thu</th>
          <th>Fri</th>
          <th>Sat</th>
        </tr>
      </thead>
      <tbody>
        <% (start_day..end_day).to_a.each_slice(7) do |week| %>
          <tr>
            <% week.each do |day| %>
              <td id="calendar_days" class="<%= 'other-month' if day.month != current_month %> <%= 'today' if day == currentDate %>" >
                <%= link_to day.day, task_date_path(date: day.strftime('%Y-%m-%d')), class: 'date-link' %>
                <% task_count = Task.where(due_date: day, user_id: current_user).count %>
                <% if task_count > 0 %>
                  <div class="task-indicator" title="<%= pluralize(task_count, 'task') %>">
                    <%= task_count %>
                  </div>
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</body>
</div>

<footer>
  <p>&copy; 2025 TaskHive. All rights reserved.</p>
</footer>

<script>
document.getElementById("newTaskButton").addEventListener("click", function() {
    var form = document.getElementById("taskFormContainer");
    form.style.display = form.style.display === "none" ? "block" : "none";
});
document.getElementById("cancelTaskButton").addEventListener("click", function() {
    document.getElementById("taskFormContainer").style.display = "none";
});
</script>